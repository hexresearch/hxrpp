
## 5-oct-2017

Попытка измерять пропускную  способность канала методом packet pairs ( примерно, как в pprate ).

Что видно на текущий момент:

Что хорошо:

 - Канал занимается очень слабо, и его использование не приводит к бану/отключению сетевого
   интерфейса на хостинге. Можно мерять с очень низкими издержками, мало серверов, маленький
   трафик, etc

 - В целом, похоже, что работает. Т.е на разных каналах величины сходятся к цифрам,
   которые соответствуют ширине канала с точностью до выплесков и некоторой 
   систематической погрешности, которые можно устранить.

 - Т.е правдоподобно меряется и ethernet и wifi на текущий момент   


Что плохо:


 - Судя по всему, в условиях, когда канал загружен не полностью,
   меряется максимальная пропускная способность канала **без шейпинга**.
   Более того, шейпинг, *видимо* работает так, что какие-то существенные
   задержки в *interpacket time intervals* начинают вноситься только
   тогда, когда загрузка канала приближается к максимальной.

   Следовательно, методика меряет физическую пропускную способность
   провода Ethernet, который воткнут в роутер, но не то, насколько
   этот канал зашейплен.

   По крайней мере, на текущий момент ситуация выглядит так, т.е
   если эта гипотеза верна, то даже улучшение точности таймстемпов
   пакетов никак не поможет.


Например, вот гистограмма с шагом 10 мегабит на канале 100 мегабит,
зашейпленном на 80 мегабит у провайдера:


	10 1486   # выплеск, интервалы между двойками пакетов
	20 5
	30 25
	40 6
	50 1
	70 28
	80 80        #
	90 186       # куда-то сюда мы должны попасть
	100 271      # пик
	110 293      # пик
	120 182      # пик
	130 67
	140 41
	150 27
	160 15
	170 8
	180 7
	190 4
	200 10
	210 4
	220 8
	230 9
	240 4
	250 2
	260 6
	270 16
	280 13
	290 14
	300 13
	310 6
	320 4
	330 4
	340 5
	360 1
	370 3
	380 1
	390 2
	400 3
	410 2
	420 3
	430 4
	440 7
	450 3
	460 9
	470 4
	480 2
	490 26
	500 16
	510 18
	520 7
	530 3
	540 4
	550 2
	660 1
	960 1

